!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n)}:e(window.jQuery)}(function(e){e.extend(e.FE.POPUP_TEMPLATES,{"embedly.insert":"[_BUTTONS_][_URL_LAYER_]","embedly.edit":"[_BUTTONS_]"}),e.extend(e.FE.DEFAULTS,{embedlyKey:null,embedlyInsertButtons:["embedlyBack","|"],embedlyEditButtons:["embedlyRemove"]}),e.FE.PLUGINS.embedly=function(t){function n(){t.events.on("html.processGet",u),t.events.$on(t.$el,"click touchend","div.fr-embedly",o),t.events.on("mousedown window.mousedown",h),t.events.on("window.touchmove",g),t.events.on("mouseup window.mouseup",v),t.events.on("commands.mousedown",function(e){e.parents(".fr-toolbar").length>0&&v()}),t.events.on("blur video.hideResizer commands.undo commands.redo element.dropped",function(){v(!0)}),t.events.on("element.beforeDrop",function(e){return e.hasClass("fr-embedly")?(e.html(e.attr("data-original-embed")),e):void 0}),t.events.on("keydown",function(n){var o=n.which;return!_||o!=e.FE.KEYCODE.BACKSPACE&&o!=e.FE.KEYCODE.DELETE?_&&o==e.FE.KEYCODE.ESC?(v(!0),n.preventDefault(),!1):_&&o!=e.FE.KEYCODE.F10&&!t.keys.isBrowserAction(n)?(n.preventDefault(),!1):void 0:(n.preventDefault(),y(),!1)},!0),t.events.on("toolbar.esc",function(){return _?(t.events.disableBlur(),t.events.focus(),!1):void 0},!0),t.events.on("toolbar.focusEditor",function(){return _?!1:void 0},!0),t.events.on("snapshot.after",function(e){var n=t.doc.createElement("div");n.innerHTML=e.html,u(n),e.html=n.innerHTML}),t.events.on("contentChanged",r),f(!0)}function o(){_=e(this),a(),l()}function r(){for(var e=t.el.querySelectorAll(".fr-embedly"),n=0;n<e.length;n++)t.node.hasClass(e[n],"fr-draggable")||(e[n].className+=" fr-draggable"),e[n].setAttribute("contenteditable",!1),e[n].setAttribute("draggable",!0)}function s(){var e="";if(t.opts.embedlyEditButtons.length>0){e+='<div class="fr-buttons">',e+=t.button.buildList(t.opts.embedlyEditButtons),e+="</div>";var n={buttons:e},o=t.popups.create("embedly.edit",n);return t.events.$on(t.$wp,"scroll.emebdly-edit",function(){_&&t.popups.isVisible("embedly.edit")&&(t.events.disableBlur(),i(_))}),o}return!1}function i(e){o.call(e.get(0))}function l(){var e=t.popups.get("embedly.edit");if(e||(e=s()),e){t.popups.setContainer("embedly.edit",t.$sc),t.popups.refresh("embedly.edit");var n=_.offset().left+_.outerWidth()/2,o=_.offset().top+_.outerHeight();t.popups.show("embedly.edit",n,o,_.outerHeight())}}function d(){t.shared.$embedly_resizer?(B=t.shared.$embedly_resizer,A=t.shared.$embedly_overlay,t.events.on("destroy",function(){B.appendTo(e("body:first"))},!0)):(t.shared.$embedly_resizer=e('<div class="fr-embedly-resizer"></div>'),B=t.shared.$embedly_resizer,t.events.$on(B,"mousedown",function(e){e.stopPropagation()},!0)),t.events.on("shared.destroy",function(){B.html("").removeData().remove(),B=null},!0)}function a(){B||d(),(t.$wp||t.$sc).append(B),B.data("instance",t),B.css("top",(t.opts.iframe?_.offset().top-1+t.$iframe.position().top:_.offset().top-t.$wp.offset().top-1)+t.$wp.scrollTop()).css("left",(t.opts.iframe?_.offset().left-1:_.offset().left-t.$wp.offset().left-1)+t.$wp.scrollLeft()).css("width",_.outerWidth()).css("height",_.height()).addClass("fr-active")}function u(e){if(e&&t.node.hasClass(e,"fr-embedly"))e.innerHTML=e.getAttribute("data-original-embed"),e.removeAttribute("draggable"),e.removeAttribute("contenteditable"),e.setAttribute("class",(e.getAttribute("class")||"").replace("fr-draggable",""));else if(e&&e.nodeType==Node.ELEMENT_NODE)for(var n=e.querySelectorAll(".fr-embedly"),o=0;o<n.length;o++)u(n[o])}function f(e){if(e)return t.popups.onRefresh("embedly.insert",m),!0;var n="";t.opts.embedlyInsertButtons.length>0&&(n+='<div class="fr-buttons">',n+=t.button.buildList(t.opts.embedlyInsertButtons),n+="</div>");var o="";o='<div class="fr-embedly-layer fr-active fr-layer" id="fr-embedly-layer-'+t.id+'"><div class="fr-input-line"><input id="fr-embedly-layer-text-'+t.id+'" type="text" placeholder="'+t.language.translate("Paste in a URL to embed")+'" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="embedlyInsert" tabIndex="2" role="button">'+t.language.translate("Insert")+"</button></div></div>";var r={buttons:n,url_layer:o},s=t.popups.create("embedly.insert",r);return s}function m(){var e=t.popups.get("embedly.insert"),n=e.find(".fr-embedly-layer input");n.val("").trigger("change")}function b(){var e=t.$tb.find('.fr-command[data-cmd="embedly"]'),n=t.popups.get("embedly.insert");if(n||(n=f()),!n.hasClass("fr-active"))if(t.popups.refresh("embedly.insert"),t.popups.setContainer("embedly.insert",t.$tb),e.is(":visible")){var o=e.offset().left+e.outerWidth()/2,r=e.offset().top+(t.opts.toolbarBottom?10:e.outerHeight()-10);t.popups.show("embedly.insert",o,r,e.outerHeight())}else t.position.forSelection(n),t.popups.show("embedly.insert")}function c(){var e=t.popups.get("embedly.insert"),n=e.find(".fr-embedly-layer input");p(n.val())}function p(e){if(e.length){var n="<a href='"+e+"' class='embedly-card'"+(t.opts.embedlyKey?" data-card-key='"+t.opts.embedlyKey+"'":"")+"></a>";t.html.insert('<div class="fr-embedly fr-draggable" draggable="true" contenteditable="false" data-original-embed="'+n+'">'+n+"</div>"),t.popups.hideAll()}}function y(){if(_&&t.events.trigger("embedly.beforeRemove",[_])!==!1){var e=_;t.popups.hideAll(),v(!0),t.selection.setBefore(e.get(0))||t.selection.setAfter(e.get(0)),e.remove(),t.selection.restore(),t.html.fillEmptyBlocks(),t.undo.saveStep(),t.events.trigger("video.removed",[e])}}function v(e){_&&(E()||e===!0)&&(B.removeClass("fr-active"),t.toolbar.enable(),_.removeClass("fr-active"),_=null,g())}function h(){t.shared.embedly_exit_flag=!0}function g(){t.shared.embedly_exit_flag=!1}function E(){return t.shared.embedly_exit_flag}function w(){return _}function C(){_?(t.events.disableBlur(),_.trigger("click")):(t.events.disableBlur(),t.selection.restore(),t.events.enableBlur(),t.popups.hide("embedly.insert"),t.toolbar.showInline())}var _,B,A;return t.shared.embedly_exit_flag=!1,{_init:n,showInsertPopup:b,insert:c,remove:y,get:w,add:p,back:C}},e.FE.DefineIcon("embedly",{NAME:"share-alt"}),e.FE.RegisterCommand("embedly",{undo:!0,focus:!0,title:"Embed URL",popup:!0,callback:function(){this.popups.isVisible("embedly.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("embedly.insert")):this.embedly.showInsertPopup()},plugin:"embedly"}),e.FE.RegisterCommand("embedlyInsert",{undo:!0,focus:!0,callback:function(){this.embedly.insert()}}),e.FE.DefineIcon("embedlyRemove",{NAME:"trash"}),e.FE.RegisterCommand("embedlyRemove",{title:"Remove",undo:!1,callback:function(){this.embedly.remove()}}),e.FE.DefineIcon("embedlyBack",{NAME:"arrow-left"}),e.FE.RegisterCommand("embedlyBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.embedly.back()},refresh:function(e){var t=this.embedly.get();t||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}})});